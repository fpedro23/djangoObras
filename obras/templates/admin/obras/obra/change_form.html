{% extends "admin/base_site.html" %}
{% load i18n admin_urls admin_static admin_modify%}

{% block extrahead %}{{ block.super }}
    <script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>
     <script type="text/javascript" src="{% static 'assets/js/ajax-movimientos.js' %}"></script>

     <link href="{% static "css/formas.css" %}" rel="stylesheet">
        <link href="{% static "css/widgets.css" %}" rel="stylesheet">
    <script type="text/javascript" src="{% static 'assets/bootstrap/js/bootstrap.file-input.js' %}"></script>
     <script type="text/javascript" src="{% static 'assets/bootstrap/js/bootstrap.js' %}"></script>
    {{ media }}
    <script type="text/javascript">
(


        function($) {
var $tt = jQuery.noConflict();

function $_GET(param)
{
/* Obtener la url completa */
url = document.URL;
/* Buscar a partir del signo de interrogación ? */
url = String(url.match(/\?+.+/));
/* limpiar la cadena quitándole el signo ? */
url = url.replace("?", "");
/* Crear un array con parametro=valor */
url = url.split("&");

/*
Recorrer el array url
obtener el valor y dividirlo en dos partes a través del signo =
0 = parametro
1 = valor
Si el parámetro existe devolver su valor
*/
x = 0;
while (x < url.length)
{
p = url[x].split("=");
if (p[0] == param)
{
return decodeURIComponent(p[1]);
}
x++;
}



}
    $(document).ready(function($) {

        $("tr input.action-select").actions();
        if ($_GET("m")==1) {
            $("#walta").hide();
            $("#wmod").show();
            $("#buscar").show();
            $("#buscarICO").show();

        }
        else {
            $("#walta").show();
            $("#wmod").hide();
             $("#buscar").hide();
            $("#buscarICO").hide();

        }


            $tt('#imgerr1').tooltip({html:true});$tt('#imgerr2').tooltip({html:true});$tt('#imgerr3').tooltip({html:true});
            $tt('#imgerr4').tooltip({html:true});$tt('#imgerr5').tooltip({html:true});$tt('#imgerr6').tooltip({html:true});
            $tt('#imgerr7').tooltip({html:true});$tt('#imgerr8').tooltip({html:true});$tt('#imgerr9').tooltip({html:true});$tt('#imgerr10').tooltip({html:true});
            $tt('#imgerr11').tooltip({html:true});$tt('#imgerr12').tooltip({html:true});$tt('#imgerr13').tooltip({html:true});$tt('#imgerr14').tooltip({html:true});
            $tt('#imgerr15').tooltip({html:true});$tt('#imgerr16').tooltip({html:true});$tt('#imgerr17').tooltip({html:true});$tt('#imgerr18').tooltip({html:true});
            $tt('#imgerr19').tooltip({html:true});$tt('#imgerr20').tooltip({html:true});$tt('#imgerr21').tooltip({html:true});$tt('#imgerr22').tooltip({html:true});

            $tt('#imgerr23').tooltip({html:true});$tt('#imgerr24').tooltip({html:true});$tt('#imgerr25').tooltip({html:true});$tt('#imgerr26').tooltip({html:true});
            $tt('#imgerr27').tooltip({html:true});$tt('#imgerr28').tooltip({html:true});$tt('#imgerr29').tooltip({html:true});$tt('#imgerr30').tooltip({html:true});

            $tt('#id_detalleinversion_set-7-monto').on('focusout',calculaTotal);
            $tt('#id_detalleinversion_set-6-monto').on('focusout',calculaTotal);
            $tt('#id_detalleinversion_set-5-monto').on('focusout',calculaTotal);
            $tt('#id_detalleinversion_set-4-monto').on('focusout',calculaTotal);
            $tt('#id_detalleinversion_set-3-monto').on('focusout',calculaTotal);
            $tt('#id_detalleinversion_set-2-monto').on('focusout',calculaTotal);
            $tt('#id_detalleinversion_set-1-monto').on('focusout',calculaTotal);
            $tt('#id_detalleinversion_set-0-monto').on('focusout',calculaTotal);
            $tt('#id_detalleinversion_set-__prefix__-monto').on('focusout',calculaTotal);
            $tt('#id_inversionTotal').on('click',calculaTotal);


    });

    function calculaTotal(){
        var TotInv=Number(0);
        var sub0,sub1,sub2,sub3,sub4,sub5,sub6,sub7;

        if (isNaN($tt('#id_detalleinversion_set-__prefix__-monto').val())) {
            sub0=Number(0);
        }else { sub0= Number($tt('#id_detalleinversion_set-__prefix__-monto').val());}

        if (isNaN($tt('#id_detalleinversion_set-0-monto').val())) {
            sub1=Number(0);
        }else { sub1= Number($tt('#id_detalleinversion_set-0-monto').val());}

         if (isNaN($tt('#id_detalleinversion_set-1-monto').val())) {
            sub2=Number(0);
        }else { sub2= Number($tt('#id_detalleinversion_set-1-monto').val());}

         if (isNaN($tt('#id_detalleinversion_set-2-monto').val())) {
            sub3=Number(0);
        }else { sub3= Number($tt('#id_detalleinversion_set-2-monto').val());}

         if (isNaN($tt('#id_detalleinversion_set-3-monto').val())) {
            sub4=Number(0);
        }else { sub4= Number($tt('#id_detalleinversion_set-3-monto').val());}

         if (isNaN($tt('#id_detalleinversion_set-4-monto').val())) {
            sub5=Number(0);
        }else { sub5= Number($tt('#id_detalleinversion_set-4-monto').val());}

         if (isNaN($tt('#id_detalleinversion_set-5-monto').val())) {
            sub6=Number(0);
        }else { sub6= Number($tt('#id_detalleinversion_set-5-monto').val());}

         if (isNaN($tt('#id_detalleinversion_set-6-monto').val())) {
            sub7=Number(0);
        }else { sub7= Number($tt('#id_detalleinversion_set-6-monto').val());}

        //alert(sub0+sub1+sub2+sub3+sub4+sub5+sub6+sub7);
        TotInv=sub0+sub1+sub2+sub3+sub4+sub5+sub6+sub7;

         $tt('#id_inversionTotal').val(TotInv);
    }
})(django.jQuery);
</script>

{% endblock %}

{% block extrastyle %}{{ block.super }}
<style>

</style>
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form{% endblock %}

{% if not is_popup %}
    {% block breadcrumbs %}
    {% endblock %}
{% endif %}

{% block content %}

    <div id="regresarBTN" onclick="location.href='/obras/movimientos'">
   </div>

  <div id="welcome">

           <span id="walta" hidden="true">Alta de Obra</span>

            <span id="wmod" hidden="true">Modificar Obra</span>



  </div>

     <div id="buscar" hidden="true">
     <input type="hidden" id="tok" value="{% csrf_token %}">
     <input class="buscar" type="text" name="idobra" value="" id="idobra">
  </div>

  <div id="buscarICO" hidden="true">
  </div>

        {% block object-tools %}
            {% if change %}{% if not is_popup %}
                <ul class="object-tools">
                    {% block object-tools-items %}
                        {% if has_absolute_url %}
                            <li><a href="{{ absolute_url }}" class="viewsitelink">{% trans "View on site" %}</a></li>
                        {% endif %}
                    {% endblock %}
                </ul>
            {% endif %}{% endif %}
        {% endblock %}
        <form {% if has_file_field %}enctype="multipart/form-data" {% endif %}action="{{ form_url }}" method="post"
              id="{{ opts.model_name }}_form" novalidate>{% csrf_token %}{% block form_top %}{% endblock %}
            {% if errors %}
                <div class="msggen">

                {% if adminform.form.non_field_errors|length == 1 %} * Favor de verificar los siguientes datos {% else %}
                        * Favor de verificar los siguientes datos {% endif %} {{ adminform.form.non_field_errors }}
                </div>
            {% endif %}
            <div>
                {% if is_popup %}<input type="hidden" name="{{ is_popup_var }}" value="1"/>{% endif %}
                {% if to_field %}<input type="hidden" name="{{ to_field_var }}" value="{{ to_field }}"/>{% endif %}
                {% if save_on_top %}{% block submit_buttons_top %}{% submit_row %}{% endblock %}{% endif %}

                {% block field_sets %}
                    {% for fieldset in adminform %}
                        {% include "admin/obras/obra/fieldset.html" %}
                    {% endfor %}
                {% endblock %}


                {% block after_field_sets %}{% endblock %}

                {% block inline_field_sets %}

                {% endblock %}

                {% block after_related_objects %}{% endblock %}

                {% block submit_buttons_bottom %}{% endblock %}
                {% block admin_change_form_document_ready %}


                    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
                    <script src="{% static "assets/bootstrap/js/bootstrap-datepicker.js"%}"></script>
                   <script type="text/javascript">
                    var $dp = jQuery.noConflict();
                    $dp('#id_fechaInicio').datepicker({
                        autoclose:true,
                        format:'yyyy-mm-dd',
                        orientation:'bottom'
                    });
                       $dp('#id_fechaTermino').datepicker({
                        autoclose:true,
                        format:'yyyy-mm-dd'
                    });
                    </script>

                 <script src="{% static "assets/js/jquery.numeric.js"%}"></script>
                 <script src="{% static "assets/js/utilerias.js"%}"></script>
                    {% endblock %}

                    {# JavaScript for prepopulated fields #}
                 {% prepopulated_fields_js %}

            </div>
        </form>


{% endblock %}